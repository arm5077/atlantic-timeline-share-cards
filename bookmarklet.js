// Drop in dependencies
$('<script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.5.2/dom-to-image.min.js"></script>').appendTo('head')
$('<link rel="stylesheet" href="https://s3.amazonaws.com/the-atlantic/timeline-dynamic-test/styles.css" />').appendTo('head')

setTimeout(function(){
    console.log('duh')
  
  var searchStrings = [
    {
      label: 'without',
      text: "You're one of the first people who's never lived in a world without "
    },
    {
      label: 'turned18',
      text: "Around your 18th birthday, "
    },
    {
      label: 'halves',
      text: "Your life can be divided into two halves: before and after "
    }
  ]

  $('.c-card__hed').each(function(i, elem){
    var text = $(elem).text();
    searchString = searchStrings.find(function(d){ return text.indexOf(d.text) != -1 })
    if( searchString )
      searchString.result = text.replace(searchString.text, '').replace('.', '')
  })


  var sentences = [
    {
      label: 'without',
      text: "I'm one of the first people who's never lived in a world without "
    },
    {
      label: 'turned18',
      text: "Around the time I turned 18, "
    },
    {
      label: 'halves',
      text: "At this moment, my life could be divided into two halves: before and after "
    }
  ]

  var card = $('<div>').appendTo('body')
    .addClass('card');

  card.html(`
    <div class='title'>This is my life in history.</div>
    <div class='text'></div>
    <div class='whats-yours'>What's yours?</div>

    <svg class = 'logo' version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    	 viewBox="0 0 600 200" enable-background="new 0 0 600 200" xml:space="preserve">
    <path d="M116.173,119.62l0.714-3.092H66.709l-0.714,3.092H116.173z M187.04,89.656h18.311l0.714-2.854h-18.312
    	l9.512-36.622h-17.122l-9.513,36.622h-14.031l-0.714,2.854h14.031l-20.689,81.093c-1.19,4.519-2.616,9.037-2.616,14.983
    	c0,5.708,3.567,11.652,13.317,11.652c18.074,0,25.922-22.115,27.348-25.207l-2.378-0.952c-1.665,3.805-8.561,18.549-16.409,18.549
    	c-3.092,0-4.994-1.902-4.994-5.708c0-1.902,0.475-4.756,1.189-7.372L187.04,89.656z M40.787,65.399h-5.945l14.031-54.696H44.83
    	l0.476-1.665h9.988l-6.183,24.019c0.951-1.426,4.281-5.945,9.275-5.945c4.756,0,6.421,3.092,6.421,5.708
    	c0,2.14-0.476,4.043-0.951,5.945L59.099,56.6c-0.237,0.951-0.713,3.329-0.713,4.518c0,1.427,0.476,1.903,1.427,1.903
    	c2.616,0,4.756-4.519,5.47-6.183l1.189,0.476c-0.714,1.665-3.33,8.799-9.513,8.799c-3.329,0-4.519-2.141-4.519-4.519
    	c0-1.665,0.714-4.756,0.952-5.47l4.756-18.311c0.476-1.665,0.951-3.567,0.951-4.994c0-1.189-0.713-2.854-3.091-2.854
    	c-3.805,0-7.372,5.47-9.037,11.653L40.787,65.399 M144.948,2.617h-2.141L13.677,192.389H3.213L2.5,195.243h32.342l0.713-2.854
    	H17.482L121.88,39.002h0.476l-17.36,153.387h-15.22l-0.713,2.854h47.086l0.714-2.854h-13.317L144.948,2.617z M554.932,115.815
    	c6.421-19.262,10.464-28.3,19.976-28.3c6.183,0,9.989,2.854,9.989,6.659c0,5.47-3.568,8.086-3.568,13.079
    	c0,4.519,3.33,7.848,7.61,7.848c5.232,0,8.561-4.28,8.561-11.176c0-7.135-4.042-19.501-23.067-19.501
    	c-20.452,0-31.154,14.506-37.336,33.055c-4.043,11.891-10.463,31.154-10.463,52.557c0,10.939,4.994,27.347,26.635,27.347
    	c22.591,0,32.341-28.299,33.769-31.629l-3.092-1.426c-3.092,7.372-11.415,26.873-25.921,26.873c-9.275,0-14.269-7.135-14.269-20.452
    	C543.755,151.487,549.7,131.51,554.932,115.815z M236.029,172.176c-1.189,3.33-9.75,25.207-27.348,25.207
    	c-9.75,0-13.317-5.706-13.317-11.652c0-5.232,1.427-10.226,2.616-14.983L239.359,9.276h-15.458l0.714-2.854h33.056l-44.233,170.272
    	c-0.713,2.854-0.951,4.994-0.951,7.372c0,3.805,1.189,5.708,4.756,5.708c7.61,0,14.744-14.506,16.409-18.549L236.029,172.176z
    	 M76.459,48.039c2.141-9.988,7.61-19.262,12.128-19.262c2.141,0,2.854,0.951,2.854,2.854C91.441,37.813,85.02,45.661,76.459,48.039z
    	 M349.226,195.243h-17.122l27.111-105.587h-15.457l0.95-2.854h32.58l-4.043,16.171c3.33-5.47,11.653-18.074,27.111-18.074
    	c13.555,0,18.311,9.037,18.311,16.171c0,6.421-1.426,11.177-2.854,16.646l-15.219,58.977c-0.714,2.616-1.188,5.232-1.188,7.61
    	c0,3.092,0.95,5.47,5.232,5.47c7.372,0,13.792-13.793,16.17-18.549l2.379,0.952c-1.19,2.616-9.751,25.207-26.873,25.207
    	c-9.513,0-13.793-5.232-13.793-11.652c0-4.519,1.664-11.177,2.616-14.983l14.982-58.501c1.19-4.756,2.378-8.798,2.378-12.604
    	c0-4.28-2.14-8.799-9.036-8.799c-11.415,0-21.403,16.646-25.684,32.818L349.226,195.243z M330.202,86.802l-23.068,89.892
    	c-0.713,2.616-1.188,4.994-1.188,6.659c-0.238,4.042,1.188,6.42,4.756,6.42c8.323,0,14.744-14.744,16.409-18.549l2.378,0.952
    	c-0.952,2.378-8.799,25.207-26.635,25.207c-9.275,0-14.031-5.944-13.793-12.604c0-2.616,0.476-6.183,0.714-7.134
    	c-3.092,6.658-11.415,19.738-24.495,19.738c-13.793,0-22.592-9.75-21.878-27.823c0.475-16.885,8.323-41.854,12.128-51.843
    	c6.421-16.646,16.408-33.293,36.622-33.293c15.22,0,17.36,11.653,18.073,14.031l2.854-11.653H330.202z M275.03,110.583
    	c-2.854,8.324-15.22,46.136-15.933,67.301c-0.238,9.512,3.091,13.793,10.226,13.793c10.226,0,18.787-13.319,24.257-30.678
    	c6.897-22.829,12.366-46.136,12.842-57.787c0.238-7.848-3.568-14.744-11.415-14.744C286.445,88.467,279.786,96.552,275.03,110.583z
    	 M501.425,89.656l-20.927,81.093c-1.19,4.281-2.616,9.513-2.616,14.031c0,6.659,4.28,12.604,14.031,12.604
    	c17.122,0,25.683-22.591,26.635-25.207l-2.378-0.952c-1.665,3.568-8.561,18.549-16.171,18.549c-4.281,0-4.994-2.378-4.994-5.945
    	c0-2.378,0.475-4.518,1.188-7.134l22.83-89.892h-48.038l9.274-36.622h-17.122l-9.275,36.622h-15.695l-0.714,2.854h15.695
    	l-20.689,81.093c-1.188,4.519-2.616,9.275-2.616,14.507c0,6.421,4.281,12.128,13.793,12.128c17.123,0,25.683-22.591,26.635-25.207
    	l-2.378-0.952c-1.665,3.805-8.324,18.549-16.409,18.549c-3.33,0-4.756-1.902-4.756-5.708c0-2.378,0.476-4.756,1.188-7.372
    	l22.117-87.038H501.425z M75.983,49.942c7.372-1.665,19.738-7.848,19.738-16.409c0-3.805-2.141-6.421-7.135-6.421
    	c-9.275,0-19.262,14.982-19.262,29.251c0,5.232,2.14,9.75,9.275,9.75c7.848,0,11.653-9.037,12.366-10.939l-1.427-0.714
    	c-1.426,3.33-4.518,8.799-9.75,8.799c-3.092,0-4.756-2.141-4.756-5.946C75.032,54.697,75.508,52.082,75.983,49.942z M518.31,46.374
    	c-5.708,0-9.75,4.519-9.75,10.939c0,5.232,3.566,9.513,8.798,9.513c5.47,0,9.75-4.519,9.75-10.701
    	C527.108,50.655,523.541,46.374,518.31,46.374z M3.927,65.399h17.598L22,63.734h-5.707l13.555-53.032h2.378
    	c6.183,0,7.61,0.714,5.707,11.415h1.427l3.33-13.08H10.824l-3.33,13.08h1.427c3.567-9.037,4.994-11.415,11.415-11.415h2.853
    	L9.634,63.734H4.403L3.927,65.399z"/>
    </svg>
    <div class='timeline-bug'>Life timeline</div>
    `)

  // Fill up the text
  sentences.forEach(function(sentence){
    answer = searchStrings.find(function(d){ return d.label == sentence.label }).result
    $('.card .text').append( sentence.text + answer + '. ')
  })

  domtoimage.toPng($('.card').get(0))
    .then(function(data){
      var img = new Image();
      img.src = data;
      console.log(data);
      $('body').append(img)
      window.open(data, 'Image')
    })
    .then(function(){
      $('.card').remove();
    })
  
  
}, 1000);
